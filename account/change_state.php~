<?php
require_once('../db_conn.php');
require_once('states.php');
echo "1";
session_start();
$username = $_SESSION['user'];
$state = $_POST["state"];
$states = getStates();
$abbr = array_search($state, $states);

echo "2";
$db =DbUtil::create();
// find user state and district
$stmt = $db->prepare("UPDATE Constituent SET state='{$abbr}' WHERE username = '{$username}'");

echo "3";
if(!$stmt){
  $_SESSION['error_msg'] = "Error updating state";
  echo $db->error;
}

echo "4";
if(!$stmt->execute()){
  $_SESSION['error_msg'] = "Error updating state";
  echo $stmt->error;
}

echo "5";
$_SESSION['success_msg'] = "Updated your state!";
header('Location: account.php');
?>
